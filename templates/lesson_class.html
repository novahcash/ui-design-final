{% extends "layout.html" %}

{% block content %}
<h1 class="themed-header">Choose a Class</h1>

<form method="POST" action="{{ url_for('save') }}">
    <input type="hidden" name="next_step" value="{{ step_index + 1 }}">
    <input type="hidden" id="selected_class" name="class" value="{{ session['progress'].get('class', '') }}">

    <div class="row justify-content-center row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
        {% set classes = [
            {"name": "Fighter", "image": "magnolia.png", "difficulty": "Easy"},
            {"name": "Rogue", "image": "magnolia.png", "difficulty": "Medium"},
            {"name": "Wizard", "image": "magnolia.png", "difficulty": "Hard"},
            {"name": "Cleric", "image": "magnolia.png", "difficulty": "Hard"}
        ] %}
        {% for c in classes %}
        <div class="col">
            <div class="card h-100 shadow class-card text-center" data-class="{{ c.name }}">
                <img src="{{ url_for('static', filename=c.image) }}" class="card-img-top" alt="{{ c.name }}">
                <div class="card-body">
                    <h5 class="card-title">{{ c.name }}</h5>
                    <p class="card-text">
                        Difficulty: 
                        <span class="{% if c.difficulty == 'Easy' %}text-success{% elif c.difficulty == 'Medium' %}text-warning{% else %}text-danger{% endif %}">
                            {{ c.difficulty }}
                        </span>
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="text-end mt-4">
        <button type="submit" class="btn btn-primary" id="next-button" disabled>Next</button>
    </div>
</form>
{% endblock %}

{% block script %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const cards = document.querySelectorAll(".class-card");
    const hiddenInput = document.getElementById("selected_class");
    const nextButton = document.getElementById("next-button");

    cards.forEach(card => {
        card.addEventListener("click", () => {
            cards.forEach(c => c.classList.remove("border-primary", "border-3"));
            card.classList.add("border-primary", "border-3");
            hiddenInput.value = card.dataset.class;
            nextButton.disabled = false;
        });

        // Re-select if already chosen
        if (card.dataset.class === hiddenInput.value) {
            card.classList.add("border-primary", "border-3");
            nextButton.disabled = false;
        }
    });
});
</script>
{% endblock %}
